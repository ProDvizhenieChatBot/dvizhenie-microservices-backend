# kanban.md
# kanban.md
### **Общая стратегия и параллельная работа**

Основная фаза рефакторинга (**Фаза 2**) завершена. Мы реализовали ключевые функции MVP из **Фазы 3**, включая динамическое управление анкетой, экспорт данных и скачивание документов. Основная серверная логика для MVP готова.

---
### **Фаза 1: Реализация базовой логики сервисов [DONE]**

*   **Статус:** Завершено.
*   **Результат:** Настроена базовая микросервисная архитектура (Docker, Nginx). Реализованы начальные версии сервисов, включая полнофункциональный `file-storage-service`.

---
### **Фаза 2: Основная бизнес-логика и функции администратора [DONE]**

*   **Статус:** Завершено.
*   **Результат:** Проведен полный рефакторинг `api-service` для поддержки основного бизнес-процесса.
    *   **Аутентификация администраторов:** Реализована через Nginx Basic Auth.
    *   **Рефакторинг моделей данных:** Модель `Application` переведена на `UUID`, добавлено поле `telegram_id` и создана связанная модель `ApplicationFile`. База данных успешно мигрирована на новую схему.
    *   **Реализация API эндпоинтов:** Созданы все необходимые эндпоинты для администраторов (просмотр, обновление статуса заявок) и для публичного использования Mini App (сохранение прогресса, привязка файлов, отправка анкеты).
    *   **Интеграция с `bot-service`:** Обновлена логика создания сессий. Теперь `bot-service` передает `telegram_id`, что позволяет пользователям возобновлять свои незавершенные заявки.

---
### **Фаза 3: Финальные функции MVP и улучшения**

#### ✅ **Завершено в этой фазе**

**(Epic) Задача 4.1: Перенести схему анкеты в базу данных**
*   **Результат:** Схема анкеты успешно перенесена из статического файла `form_schema.json` в базу данных (таблица `form_schemas`). Реализован публичный эндпоинт для получения активной схемы и эндпоинт для администраторов для загрузки и активации новой версии схемы. Это делает анкету полностью динамической.

**Задача 6.1: Реализовать создание сессии для веб-виджета**
*   **Результат:** Реализован эндпоинт `POST /api/v1/sessions/web`. Он создает новую "анонимную" заявку со статусом `draft` (без `telegram_id`) и возвращает ее `application_uuid`. Это позволяет пользователям с сайта начать заполнение анкеты.

**Задача 6.2: Реализовать экспорт заявок в XLSX**
*   **Результат:** Создан эндпоинт для администраторов `GET /api/v1/admin/applications/export`. Он извлекает все заявки, "расплющивает" JSON-поле с данными в плоскую структуру и возвращает готовый XLSX-файл. Логика генерации файла вынесена в отдельный сервис.

**Задача 6.3: Реализовать скачивание документов заявки ZIP-архивом**
*   **Результат:** Создан эндпоинт `GET /api/v1/admin/applications/{uuid}/download-documents`. `api-service` теперь выступает в роли координатора: получает из БД список файлов заявки, запрашивает у `file-storage-service` временные ссылки на скачивание, загружает по ним файлы в память и упаковывает их в ZIP-архив, который отдает администратору.

#### ➡️ **Далее в плане**

**Задача 7.1: Добавить базовое логирование**
*   **Описание:** Улучшить наблюдаемость и отладку сервисов путем добавления структурированного логирования.
*   **Подзадачи:**
    1.  **API Service:** Настроить логирование для ключевых операций: создание сессии, получение/обновление заявок, ошибки.
    2.  **Bot Service:** Добавить логирование для вызовов API и ошибок при взаимодействии с Telegram.
    3.  **File Storage Service:** Улучшить логирование при загрузке файлов и возникновении ошибок S3.
*   **Критерии готовности:** В консоли Docker видны информативные логи о работе сервисов.
*   **Зависимости:** Нет, может выполняться параллельно.

**Задача 7.2: Реализовать проверку статуса заявки для пользователя**
*   **Описание:** Дать пользователю возможность узнать текущий статус своей заявки.
*   **Подзадачи (Backend - API Service):**
    1.  Создать эндпоинт `GET /api/v1/sessions/telegram/status`, принимающий `telegram_id` и возвращающий статус последней заявки (`{"status": "..."}`).
    2.  Создать эндпоинт `GET /api/v1/applications/{application_uuid}/public/status` для веб-виджета, который возвращает только статус заявки.
*   **Подзадачи (Frontend - Bot Service):**
    1.  Реализовать обработчик для команды `/status`.
*   **Критерии готовности:** Пользователь может получить актуальный статус своей заявки через Telegram-бот или по прямой ссылке.
*   **Зависимости:** Нет.

---
### **Фаза 4: Документация**

**Задача 8.1: Создать руководство по `form_schema.json`**
*   **Описание:** Подготовить документ на русском языке, объясняющий структуру и все возможные поля JSON-схемы анкеты.
*   **Целевая аудитория:** Менеджеры фонда, которые будут редактировать анкету в будущем.
*   **Критерии готовности:** Создан понятный `.md` файл с документацией.
*   **Зависимости:** Нет.

**Задача 9.1: Создать динамический сервис документации API**
*   **Описание:** Заменить статический `openapi.yaml` на динамический микросервис `docs-service`, который "на лету" собирает и объединяет OpenAPI спецификации от всех остальных сервисов.
*   **Критерии готовности:** По адресу `http://localhost:8000/docs` открывается единая, актуальная документация по всем API эндпоинтам проекта.
*   **Зависимости:** Нет.
---