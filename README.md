# Бэкенд для MVP благотворительного фонда "Движение Жизни"

Этот проект представляет собой бэкенд-систему, реализованную на микросервисной архитектуре, для автоматизации сбора заявок от подопечных через чат-бота в Telegram.

## Оглавление

- [Технологический стек](#технологический-стек)
- [Требования](#требования)
- [Быстрый старт](#быстрый-старт)
- [Доступ к сервисам](#доступ-к-сервисам)
- [Разработка](#разработка)
  - [Pre-commit хуки](#pre-commit-хуки)
- [Конфигурация (.env)](#конфигурация-env)
- [Структура проекта](#структура-проекта)

## Технологический стек

*   **Язык:** Python 3.12
*   **Фреймворки:** FastAPI (для API), Aiogram 3 (для Telegram-бота)
*   **База данных:** PostgreSQL
*   **Хранилище файлов:** MinIO (S3-совместимое)
*   **Оркестрация:** Docker, Docker Compose
*   **Веб-сервер/API Gateway:** Nginx
*   **Инструменты разработки:** Ruff, Pyright, Pre-commit, UV

## Требования

Для запуска и работы с проектом вам понадобятся:

*   **Docker**
*   **Docker Compose**
*   **Git**

Для локальной разработки также рекомендуется установить:
*   [uv](https://github.com/astral-sh/uv) (быстрый менеджер пакетов Python)
*   [pre-commit](https://pre-commit.com/) (для запуска проверок перед коммитом)

## Быстрый старт

1.  **Клонируйте репозиторий:**
    ```bash
    git clone https://github.com/ProDvizhenieChatBot/dvizhenie-microservices-backend.git
    cd dvizhenie-microservices-backend
    ```

2.  **Создайте файл конфигурации:**
    Скопируйте файл с примером переменных окружения.
    ```bash
    cp .env.example .env
    ```

3.  **Заполните `.env` файл:**
    Откройте файл `.env` в текстовом редакторе и обязательно заполните следующие переменные:
    *   `TELEGRAM_BOT_TOKEN`: Укажите токен вашего Telegram-бота.
    *   `MINI_APP_URL`: Укажите URL, на котором будет размещено ваше веб-приложение (Mini App).

4.  **Соберите и запустите контейнеры:**
    Эта команда скачает образы, соберет ваши сервисы и запустит их в фоновом режиме.
    ```bash
    docker-compose up -d --build
    ```

После выполнения этих шагов вся система будет запущена и готова к работе.

## Доступ к сервисам

После успешного запуска сервисы будут доступны по следующим адресам:

*   **API Gateway (Nginx):** `http://localhost:8000`
    *   Все запросы к API (`/api/...`) и файловому хранилищу (`/api/v1/files/...`) проходят через этот шлюз.
*   **Документация API Service:** `http://localhost:8000/docs`
*   **MinIO Console (веб-интерфейс для файлов):** `http://localhost:9001`
    *   **Логин:** `minioadmin` (или значение `MINIO_ROOT_USER` из `.env`)
    *   **Пароль:** `minioadmin` (или значение `MINIO_ROOT_PASSWORD` из `.env`)
*   **Telegram Бот:**
    *   Найдите вашего бота в Telegram и отправьте ему команду `/start`.

Чтобы остановить все сервисы, выполните команду:
```bash
docker-compose down
```

## Разработка

### Pre-commit хуки

В проекте настроены pre-commit хуки для автоматической проверки и форматирования кода перед каждым коммитом. Это обеспечивает единый стиль кода и помогает избежать простых ошибок.

1.  **Установка (один раз для проекта):**
    После установки `pre-commit` глобально, выполните в корне проекта:
    ```bash
    pre-commit install
    ```

2.  **Использование:**
    Теперь, при каждой попытке `git commit`, будут автоматически запускаться `ruff` (форматирование и линтинг) и `pyright` (проверка типов). Если хуки найдут ошибки, коммит будет прерван. Исправьте ошибки и повторите коммит.

3.  **Ручной запуск:**
    Вы можете запустить все проверки для всех файлов в любой момент:
    ```bash
    pre-commit run --all-files
    ```

## Конфигурация (.env)

Основные переменные, которые можно настроить в файле `.env`:

*   `POSTGRES_*`: Настройки для подключения к базе данных PostgreSQL.
*   `TELEGRAM_BOT_TOKEN`: Секретный токен для вашего Telegram-бота.
*   `MINI_APP_URL`: URL для кнопки Mini App, которую бот отправляет пользователю.
*   `API_SERVICE_URL`: Внутренний адрес API-сервиса, используемый ботом.
*   `MINIO_*`: Учетные данные и название бакета для S3-хранилища MinIO.

## Структура проекта

*   `services/`: Основная директория, содержащая код каждого микросервиса.
    *   `api_service/`: Сервис с основной бизнес-логикой, управлением заявками и пользователями.
    *   `bot_service/`: Сервис, отвечающий за взаимодействие с Telegram Bot API.
    *   `file_storage_service/`: Сервис для загрузки и скачивания файлов в MinIO.
*   `nginx/`: Конфигурация для Nginx, который выступает в роли API Gateway.
*   `docker-compose.yml`: Файл для оркестрации и запуска всех сервисов проекта.
*   `.env.example`: Шаблон с необходимыми переменными окружения.
*   `.pre-commit-config.yaml`: Конфигурация для pre-commit хуков.
